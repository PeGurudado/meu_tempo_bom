CREATE OR REPLACE STREAM "DESTINATION_SQL_STREAM" (
    DC_NOME VARCHAR(64),
    TEM_INS double,
    UMD_INS double,
    HI double,
    TEM_MIN double, 
    TEM_MAX double, 
    RAD_GLO double, 
    VEN_DIR double,
    DT_MEDICAO VARCHAR(16),
    HR_MEDICAO integer); 


CREATE OR REPLACE PUMP "STREAM_PUMP" AS INSERT INTO "DESTINATION_SQL_STREAM"
select STREAM DC_NOME, TEM_INS, UMD_INS,
CASE WHEN (HI <80) THEN ((HI-32) * 5/9) 
ELSE CASE (-42.379 + 
2.04901523 * TEM_INS + 
10.14333127 * UMD_INS - 
0.22475541 * TEM_INS * UMD_INS - 
6.83783 * POWER(10,-3) * POWER(TEM_INS,2) - 
5.481717 * POWER(10,-2) * POWER(UMD_INS,2) +
1.22874 * POWER(10,-3) * POWER(TEM_INS,2) * UMD_INS + 
8.5282 * POWER(10,-4) * TEM_INS * POWER(UMD_INS,2) -
1.99 * POWER(10,-6) * POWER(TEM_INS,2) * POWER(UMD_INS,2)) = HI
WHEN (TEM_INS >= 80 and TEM_INS <=112 and UMD_INS <= 13 ) THEN (((HI - (3.25 - 0.25 * UMD_INS) * ((17 - ABS(TEM_INS-95))/17)*0.5 )-32) * 5/9)
WHEN (TEM_INS >= 80 and TEM_INS <= 87 and UMD_INS > 85) THEN (HI + 0.02 * (((UMD_INS -85) * (87-TEM_INS)) -32) * 5/9) 
ELSE null END END, TEM_MIN, TEM_MAX, RAD_GLO, VEN_DIR, DT_MEDICAO, HR_MEDICAO
FROM (select stream DC_NOME, ((TEM_INS * 9/5) + 32) as TEM_INS  , UMD_INS, (1.1 * ((TEM_INS * 9/5) + 32) - 10.3 + 0.047 * UMD_INS) as HI, TEM_MIN, TEM_MAX, RAD_GLO, VEN_DIR, DT_MEDICAO, HR_MEDICAO from "SOURCE_SQL_STREAM_001"
    WINDOW W1 AS (PARTITION BY UMD_INS RANGE INTERVAL '10' SECOND PRECEDING)
);
